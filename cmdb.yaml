openapi: 3.0.3
info:
  title: CMDB API
  description: 配置管理数据�?API - 提供资源模型和实例的统一管理接口
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: /api/v1
    description: API Server

tags:
  - name: Model
    description: 资源模型管理
  - name: ModelGroup
    description: 模型分组管理
  - name: Attribute
    description: 模型属性管�?
  - name: AttributeGroup
    description: 属性分组管�?
  - name: Instance
    description: 资源实例管理
  - name: ModelRelation
    description: 模型关系类型管理
  - name: InstanceRelation
    description: 实例关系管理
  - name: Topology
    description: 拓扑视图

paths:
  # ==================== 模型管理 ====================
  /cmdb/models:
    post:
      tags:
        - Model
      summary: 创建模型
      description: 创建新的资源模型定义
      operationId: createModel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateModelReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateModelResp'

    get:
      tags:
        - Model
      summary: 获取模型列表
      description: 获取资源模型列表，支持按云厂商、类别等条件过滤
      operationId: listModels
      parameters:
        - name: provider
          in: query
          description: 云厂商标�?(aliyun, aws, azure)
          schema:
            type: string
        - name: category
          in: query
          description: 资源类别 (compute, storage, network, database, security, iam)
          schema:
            type: string
        - name: parent_uid
          in: query
          description: 父模型UID
          schema:
            type: string
        - name: level
          in: query
          description: 层级 (1=主资�? 2=子资�?
          schema:
            type: integer
        - name: offset
          in: query
          description: 偏移�?
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          description: 每页数量
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelListResp'

  /cmdb/models/{uid}:
    get:
      tags:
        - Model
      summary: 获取模型详情
      description: 根据UID获取模型详细信息
      operationId: getModelByUID
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelResp'
        '404':
          description: 模型不存�?
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResp'

    put:
      tags:
        - Model
      summary: 更新模型
      description: 更新指定模型的信�?
      operationId: updateModel
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateModelReq'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'
        '404':
          description: 模型不存�?

    delete:
      tags:
        - Model
      summary: 删除模型
      description: 删除指定的资源模�?
      operationId: deleteModel
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'
        '404':
          description: 模型不存�?

  # ==================== 模型分组管理 ====================
  /cmdb/model-groups:
    post:
      tags:
        - ModelGroup
      summary: 创建模型分组
      description: 创建新的模型分组用于组织管理模型
      operationId: createModelGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateModelGroupReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateIDResp'
        '409':
          description: 分组已存�?

    get:
      tags:
        - ModelGroup
      summary: 获取模型分组列表
      operationId: listModelGroups
      parameters:
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelGroupListResp'

  /cmdb/model-groups/with-models:
    get:
      tags:
        - ModelGroup
      summary: 获取分组列表及其下的模型
      description: 获取所有分组及每个分组下的模型列表，用于前端树形展�?
      operationId: listModelGroupsWithModels
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelGroupWithModelsListResp'

  /cmdb/model-groups/init:
    post:
      tags:
        - ModelGroup
      summary: 初始化内置分�?
      description: 初始化系统预置的模型分组
      operationId: initBuiltinModelGroups
      responses:
        '200':
          description: 初始化成�?

  /cmdb/model-groups/{uid}:
    get:
      tags:
        - ModelGroup
      summary: 获取模型分组详情
      operationId: getModelGroup
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelGroupResp'
        '404':
          description: 分组不存�?

    put:
      tags:
        - ModelGroup
      summary: 更新模型分组
      operationId: updateModelGroup
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateModelGroupReq'
      responses:
        '200':
          description: 更新成功

    delete:
      tags:
        - ModelGroup
      summary: 删除模型分组
      description: 删除分组（内置分组不可删除，有模型的分组不可删除�?
      operationId: deleteModelGroup
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 删除成功
        '400':
          description: 分组不可删除（内置分组或有模型）
        '404':
          description: 分组不存�?

  # ==================== 字段类型 ====================
  /cmdb/field-types:
    get:
      tags:
        - Attribute
      summary: 获取字段类型列表
      description: 获取所有支持的字段类型，用于前端下拉选择
      operationId: getFieldTypes
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FieldTypesResp'

  # ==================== 模型属性管�?====================
  /cmdb/models/{uid}/attributes:
    post:
      tags:
        - Attribute
      summary: 创建模型属�?
      description: 为指定模型创建新的属性字�?
      operationId: createAttribute
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAttributeReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateIDResp'
        '404':
          description: 模型不存�?
        '409':
          description: 属性已存在

    get:
      tags:
        - Attribute
      summary: 获取模型属性列�?
      description: 获取指定模型的所有属�?
      operationId: listAttributes
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
        - name: group_id
          in: query
          description: 属性分组ID
          schema:
            type: integer
            format: int64
        - name: field_type
          in: query
          description: 字段类型
          schema:
            type: string
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributeListResp'

  /cmdb/models/{uid}/attributes/grouped:
    get:
      tags:
        - Attribute
      summary: 获取分组后的属性列�?
      description: 获取按分组组织的属性列表，用于前端分组展示
      operationId: listAttributesWithGroups
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributeGroupWithAttrsListResp'

  /cmdb/models/{uid}/attributes/{id}:
    get:
      tags:
        - Attribute
      summary: 获取属性详�?
      operationId: getAttribute
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          description: 属性ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributeResp'
        '404':
          description: 属性不存在

    put:
      tags:
        - Attribute
      summary: 更新属�?
      operationId: updateAttribute
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAttributeReq'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'
        '404':
          description: 属性不存在

    delete:
      tags:
        - Attribute
      summary: 删除属�?
      operationId: deleteAttribute
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 删除成功
        '404':
          description: 属性不存在

  # ==================== 属性分组管�?====================
  /cmdb/models/{uid}/attribute-groups:
    post:
      tags:
        - AttributeGroup
      summary: 创建属性分�?
      description: 为指定模型创建新的属性分�?
      operationId: createAttributeGroup
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAttributeGroupReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateIDResp'
        '404':
          description: 模型不存�?

    get:
      tags:
        - AttributeGroup
      summary: 获取属性分组列�?
      operationId: listAttributeGroups
      parameters:
        - name: uid
          in: path
          required: true
          description: 模型唯一标识
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributeGroupListResp'

  /cmdb/models/{uid}/attribute-groups/{id}:
    get:
      tags:
        - AttributeGroup
      summary: 获取属性分组详�?
      operationId: getAttributeGroup
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          description: 分组ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributeGroupResp'
        '404':
          description: 分组不存�?

    put:
      tags:
        - AttributeGroup
      summary: 更新属性分�?
      operationId: updateAttributeGroup
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAttributeGroupReq'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'
        '404':
          description: 分组不存�?

    delete:
      tags:
        - AttributeGroup
      summary: 删除属性分�?
      description: 删除属性分组（内置分组不可删除�?
      operationId: deleteAttributeGroup
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 删除成功
        '400':
          description: 内置分组不可删除
        '404':
          description: 分组不存�?

  # ==================== 实例管理 ====================
  /cmdb/instances:
    post:
      tags:
        - Instance
      summary: 创建实例
      description: 创建新的资源实例
      operationId: createInstance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInstanceReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateInstanceResp'
        '409':
          description: 实例已存�?

    get:
      tags:
        - Instance
      summary: 获取实例列表
      description: 获取资源实例列表，支持多种过滤条�?
      operationId: listInstances
      parameters:
        - name: uid
          in: query
          description: 模型UID (�?aliyun_ecs, aws_ec2)
          schema:
            type: string
        - name: tenant_id
          in: query
          description: 租户ID
          schema:
            type: string
        - name: account_id
          in: query
          description: 云账号ID
          schema:
            type: integer
            format: int64
        - name: asset_name
          in: query
          description: 资产名称 (模糊搜索)
          schema:
            type: string
        - name: status
          in: query
          description: 状�?(Running, Stopped�?
          schema:
            type: string
        - name: region
          in: query
          description: 地域
          schema:
            type: string
        - name: offset
          in: query
          description: 偏移�?
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          description: 每页数量
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceListResp'

  /cmdb/instances/batch:
    post:
      tags:
        - Instance
      summary: 批量创建实例
      description: 批量创建多个资源实例
      operationId: createInstanceBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBatchInstanceReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchCreateResp'

  /cmdb/instances/upsert:
    post:
      tags:
        - Instance
      summary: 更新或插入实�?
      description: 根据 tenant_id + uid + asset_id 更新或插入实例，适用于资源同步场�?
      operationId: upsertInstance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpsertInstanceReq'
      responses:
        '200':
          description: 操作成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'

  /cmdb/instances/upsert-batch:
    post:
      tags:
        - Instance
      summary: 批量更新或插入实�?
      description: 批量根据 tenant_id + uid + asset_id 更新或插入实�?
      operationId: upsertInstanceBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpsertBatchInstanceReq'
      responses:
        '200':
          description: 操作成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'

  /cmdb/instances/{id}:
    get:
      tags:
        - Instance
      summary: 获取实例详情
      description: 根据ID获取实例详细信息
      operationId: getInstanceByID
      parameters:
        - name: id
          in: path
          required: true
          description: 实例ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceResp'
        '404':
          description: 实例不存�?

    put:
      tags:
        - Instance
      summary: 更新实例
      description: 更新指定实例的信�?
      operationId: updateInstance
      parameters:
        - name: id
          in: path
          required: true
          description: 实例ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateInstanceReq'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'
        '404':
          description: 实例不存�?

    delete:
      tags:
        - Instance
      summary: 删除实例
      description: 删除指定的资源实�?
      operationId: deleteInstance
      parameters:
        - name: id
          in: path
          required: true
          description: 实例ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'
        '404':
          description: 实例不存�?

  # ==================== 模型关系类型管理 ====================
  /cmdb/model-relations:
    post:
      tags:
        - ModelRelation
      summary: 创建模型关系类型
      description: 定义两个模型之间可以建立什么样的关�?
      operationId: createModelRelation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateModelRelationReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateIDResp'

    get:
      tags:
        - ModelRelation
      summary: 获取模型关系类型列表
      operationId: listModelRelations
      parameters:
        - name: source_uid
          in: query
          description: 源模型UID
          schema:
            type: string
        - name: target_uid
          in: query
          description: 目标模型UID
          schema:
            type: string
        - name: relation_type
          in: query
          description: 关系类型
          schema:
            type: string
            enum: [belongs_to, contains, bindto, connects, depends_on]
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelRelationListResp'

  /cmdb/model-relations/{uid}:
    get:
      tags:
        - ModelRelation
      summary: 获取模型关系类型详情
      operationId: getModelRelation
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelRelationResp'
        '404':
          description: 关系类型不存�?

    put:
      tags:
        - ModelRelation
      summary: 更新模型关系类型
      operationId: updateModelRelation
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateModelRelationReq'
      responses:
        '200':
          description: 更新成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResp'

    delete:
      tags:
        - ModelRelation
      summary: 删除模型关系类型
      operationId: deleteModelRelation
      parameters:
        - name: uid
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 删除成功

  # ==================== 实例关系管理 ====================
  /cmdb/instance-relations:
    post:
      tags:
        - InstanceRelation
      summary: 创建实例关系
      description: 创建两个实例之间的关�?
      operationId: createInstanceRelation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInstanceRelationReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateIDResp'
        '409':
          description: 关系已存�?

    get:
      tags:
        - InstanceRelation
      summary: 获取实例关系列表
      operationId: listInstanceRelations
      parameters:
        - name: source_instance_id
          in: query
          description: 源实例ID
          schema:
            type: integer
            format: int64
        - name: target_instance_id
          in: query
          description: 目标实例ID
          schema:
            type: integer
            format: int64
        - name: relation_type_uid
          in: query
          description: 关系类型UID
          schema:
            type: string
        - name: tenant_id
          in: query
          description: 租户ID
          schema:
            type: string
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstanceRelationListResp'

  /cmdb/instance-relations/batch:
    post:
      tags:
        - InstanceRelation
      summary: 批量创建实例关系
      operationId: createBatchInstanceRelation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBatchInstanceRelationReq'
      responses:
        '200':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchCreateResp'

  /cmdb/instance-relations/{id}:
    delete:
      tags:
        - InstanceRelation
      summary: 删除实例关系
      operationId: deleteInstanceRelation
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 删除成功
        '404':
          description: 关系不存�?

  # ==================== 拓扑视图 ====================
  /cmdb/topology/instance/{id}:
    get:
      tags:
        - Topology
      summary: 获取实例拓扑�?
      description: 获取指定实例的关联拓扑图，用于可视化展示资源关系
      operationId: getInstanceTopology
      parameters:
        - name: id
          in: path
          required: true
          description: 实例ID
          schema:
            type: integer
            format: int64
        - name: depth
          in: query
          description: 查询深度
          schema:
            type: integer
            default: 1
        - name: direction
          in: query
          description: 查询方向
          schema:
            type: string
            enum: [both, outgoing, incoming]
            default: both
        - name: uid
          in: query
          description: 按模型过�?
          schema:
            type: string
        - name: tenant_id
          in: query
          description: 租户ID
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TopologyGraphResp'

  /cmdb/topology/model:
    get:
      tags:
        - Topology
      summary: 获取模型拓扑�?
      description: 获取模型间的关系定义图，用于展示资源模型架构
      operationId: getModelTopology
      parameters:
        - name: provider
          in: query
          description: 云厂商过�?
          schema:
            type: string
            enum: [aliyun, aws, azure]
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelTopologyGraphResp'

  /cmdb/topology/related/{id}:
    get:
      tags:
        - Topology
      summary: 获取关联实例列表
      description: 获取指定实例的关联实例列�?
      operationId: getRelatedInstances
      parameters:
        - name: id
          in: path
          required: true
          description: 实例ID
          schema:
            type: integer
            format: int64
        - name: relation_type_uid
          in: query
          description: 关系类型UID过滤
          schema:
            type: string
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelatedInstancesResp'

components:
  schemas:
    # ==================== 通用响应 ====================
    SuccessResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          nullable: true

    ErrorResp:
      type: object
      properties:
        code:
          type: integer
          example: 404001
        msg:
          type: string
          example: model not found
        data:
          type: object
          nullable: true

    # ==================== 模型相关 ====================
    CreateModelReq:
      type: object
      required:
        - uid
        - name
        - category
      properties:
        uid:
          type: string
          description: 模型唯一标识
          example: aliyun_ecs
        name:
          type: string
          description: 模型名称
          example: 阿里云ECS
        model_group_id:
          type: integer
          format: int64
          description: 模型分组ID
          example: 1
        parent_uid:
          type: string
          description: 父模型UID
        category:
          type: string
          description: 资源类别
          enum: [compute, storage, network, database, security, iam]
          example: compute
        level:
          type: integer
          description: 层级 (1=主资�? 2=子资�?
          default: 1
        icon:
          type: string
          description: 图标
        description:
          type: string
          description: 描述
        provider:
          type: string
          description: 云厂�?
          enum: [aliyun, aws, azure, all]
          example: aliyun
        extensible:
          type: boolean
          description: 是否可扩�?
          default: true

    UpdateModelReq:
      type: object
      properties:
        name:
          type: string
          description: 模型名称
        model_group_id:
          type: integer
          format: int64
          description: 模型分组ID
        icon:
          type: string
          description: 图标
        description:
          type: string
          description: 描述
        extensible:
          type: boolean
          description: 是否可扩�?

    ModelVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 模型ID
          example: 1
        uid:
          type: string
          description: 模型唯一标识
          example: aliyun_ecs
        name:
          type: string
          description: 模型名称
          example: 阿里云ECS
        model_group_id:
          type: integer
          format: int64
          description: 模型分组ID
          example: 1
        parent_uid:
          type: string
          description: 父模型UID
        category:
          type: string
          description: 资源类别
          example: compute
        level:
          type: integer
          description: 层级
          example: 1
        icon:
          type: string
          description: 图标
        description:
          type: string
          description: 描述
        provider:
          type: string
          description: 云厂�?
          example: aliyun
        extensible:
          type: boolean
          description: 是否可扩�?
        create_time:
          type: integer
          format: int64
          description: 创建时间�?毫秒)
        update_time:
          type: integer
          format: int64
          description: 更新时间�?毫秒)

    CreateModelResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            id:
              type: integer
              format: int64
              description: 创建的模型ID

    ModelResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/ModelVO'

    ModelListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            models:
              type: array
              items:
                $ref: '#/components/schemas/ModelVO'
            total:
              type: integer
              format: int64
              description: 总数

    # ==================== 模型分组相关 ====================
    CreateModelGroupReq:
      type: object
      required:
        - uid
        - name
      properties:
        uid:
          type: string
          description: 分组唯一标识
          example: cloud
        name:
          type: string
          description: 分组名称
          example: 云资�?
        icon:
          type: string
          description: 图标
          example: cloud
        sort_order:
          type: integer
          description: 排序顺序
          example: 1
        description:
          type: string
          description: 描述

    UpdateModelGroupReq:
      type: object
      properties:
        name:
          type: string
          description: 分组名称
        icon:
          type: string
          description: 图标
        sort_order:
          type: integer
          description: 排序顺序
        description:
          type: string
          description: 描述

    ModelGroupVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 分组ID
        uid:
          type: string
          description: 分组唯一标识
          example: cloud
        name:
          type: string
          description: 分组名称
          example: 云资�?
        icon:
          type: string
          description: 图标
        sort_order:
          type: integer
          description: 排序顺序
        is_builtin:
          type: boolean
          description: 是否内置分组
        description:
          type: string
          description: 描述
        create_time:
          type: integer
          format: int64
          description: 创建时间�?毫秒)
        update_time:
          type: integer
          format: int64
          description: 更新时间�?毫秒)

    ModelGroupWithModelsVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        uid:
          type: string
        name:
          type: string
        icon:
          type: string
        sort_order:
          type: integer
        is_builtin:
          type: boolean
        description:
          type: string
        create_time:
          type: integer
          format: int64
        update_time:
          type: integer
          format: int64
        models:
          type: array
          description: 分组下的模型列表
          items:
            $ref: '#/components/schemas/ModelVO'

    ModelGroupResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/ModelGroupVO'

    ModelGroupListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            groups:
              type: array
              items:
                $ref: '#/components/schemas/ModelGroupVO'
            total:
              type: integer
              format: int64

    ModelGroupWithModelsListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            groups:
              type: array
              items:
                $ref: '#/components/schemas/ModelGroupWithModelsVO'

    # ==================== 属性相�?Schema ====================
    FieldTypeVO:
      type: object
      properties:
        value:
          type: string
          description: 字段类型�?
          example: string
        label:
          type: string
          description: 字段类型显示名称
          example: 短文�?

    FieldTypesResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: array
          items:
            $ref: '#/components/schemas/FieldTypeVO'

    CreateAttributeReq:
      type: object
      required:
        - field_uid
        - field_name
        - field_type
      properties:
        field_uid:
          type: string
          description: 字段唯一标识
          example: instance_id
        field_name:
          type: string
          description: 字段名称
          example: 实例ID
        field_type:
          type: string
          description: 字段类型
          enum: [string, text, int, float, bool, enum, datetime, date, array, json, link]
          example: string
        group_id:
          type: integer
          format: int64
          description: 属性分组ID
        display_name:
          type: string
          description: 显示名称
        display:
          type: boolean
          description: 是否显示
          default: true
        index:
          type: integer
          description: 排序索引
          default: 0
        required:
          type: boolean
          description: 是否必填
          default: false
        editable:
          type: boolean
          description: 是否可编�?
          default: true
        searchable:
          type: boolean
          description: 是否可搜�?
          default: false
        unique:
          type: boolean
          description: 是否唯一
          default: false
        secure:
          type: boolean
          description: 是否敏感字段
          default: false
        link:
          type: boolean
          description: 是否关联字段
          default: false
        link_model:
          type: string
          description: 关联的模型UID
        option:
          type: string
          description: 选项�?JSON格式，用于enum类型)
          example: '["Running","Stopped","Pending"]'
        default:
          type: string
          description: 默认�?
        placeholder:
          type: string
          description: 占位提示
        description:
          type: string
          description: 字段描述

    UpdateAttributeReq:
      type: object
      properties:
        field_name:
          type: string
          description: 字段名称
        field_type:
          type: string
          description: 字段类型
          enum: [string, text, int, float, bool, enum, datetime, date, array, json, link]
        group_id:
          type: integer
          format: int64
          description: 属性分组ID
        display_name:
          type: string
          description: 显示名称
        display:
          type: boolean
          description: 是否显示
        index:
          type: integer
          description: 排序索引
        required:
          type: boolean
          description: 是否必填
        editable:
          type: boolean
          description: 是否可编�?
        searchable:
          type: boolean
          description: 是否可搜�?
        unique:
          type: boolean
          description: 是否唯一
        secure:
          type: boolean
          description: 是否敏感字段
        link:
          type: boolean
          description: 是否关联字段
        link_model:
          type: string
          description: 关联的模型UID
        option:
          type: string
          description: 选项�?JSON格式)
        default:
          type: string
          description: 默认�?
        placeholder:
          type: string
          description: 占位提示
        description:
          type: string
          description: 字段描述

    AttributeVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 属性ID
        field_uid:
          type: string
          description: 字段唯一标识
          example: instance_id
        field_name:
          type: string
          description: 字段名称
          example: 实例ID
        field_type:
          type: string
          description: 字段类型
          example: string
        uid:
          type: string
          description: 所属模型UID
          example: ecs
        group_id:
          type: integer
          format: int64
          description: 属性分组ID
        display_name:
          type: string
          description: 显示名称
        display:
          type: boolean
          description: 是否显示
        index:
          type: integer
          description: 排序索引
        required:
          type: boolean
          description: 是否必填
        editable:
          type: boolean
          description: 是否可编�?
        searchable:
          type: boolean
          description: 是否可搜�?
        unique:
          type: boolean
          description: 是否唯一
        secure:
          type: boolean
          description: 是否敏感字段
        link:
          type: boolean
          description: 是否关联字段
        link_model:
          type: string
          description: 关联的模型UID
        option:
          type: string
          description: 选项�?JSON格式)
        default:
          type: string
          description: 默认�?
        placeholder:
          type: string
          description: 占位提示
        description:
          type: string
          description: 字段描述
        create_time:
          type: integer
          format: int64
          description: 创建时间�?毫秒)
        update_time:
          type: integer
          format: int64
          description: 更新时间�?毫秒)

    AttributeResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/AttributeVO'

    AttributeListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            attributes:
              type: array
              items:
                $ref: '#/components/schemas/AttributeVO'
            total:
              type: integer
              format: int64

    # ==================== 属性分组相�?Schema ====================
    CreateAttributeGroupReq:
      type: object
      required:
        - uid
        - name
      properties:
        uid:
          type: string
          description: 分组唯一标识
          example: basic
        name:
          type: string
          description: 分组名称
          example: 基本信息
        index:
          type: integer
          description: 排序索引
          default: 0
        description:
          type: string
          description: 描述

    UpdateAttributeGroupReq:
      type: object
      properties:
        name:
          type: string
          description: 分组名称
        index:
          type: integer
          description: 排序索引
        description:
          type: string
          description: 描述

    AttributeGroupVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 分组ID
        uid:
          type: string
          description: 分组唯一标识
          example: basic
        name:
          type: string
          description: 分组名称
          example: 基本信息
        uid:
          type: string
          description: 所属模型UID
        index:
          type: integer
          description: 排序索引
        is_builtin:
          type: boolean
          description: 是否内置分组
        description:
          type: string
          description: 描述
        create_time:
          type: integer
          format: int64
          description: 创建时间�?毫秒)
        update_time:
          type: integer
          format: int64
          description: 更新时间�?毫秒)

    AttributeGroupWithAttrsVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        uid:
          type: string
        name:
          type: string
        uid:
          type: string
        index:
          type: integer
        is_builtin:
          type: boolean
        description:
          type: string
        create_time:
          type: integer
          format: int64
        update_time:
          type: integer
          format: int64
        attributes:
          type: array
          description: 分组下的属性列�?
          items:
            $ref: '#/components/schemas/AttributeVO'

    AttributeGroupResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/AttributeGroupVO'

    AttributeGroupListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: array
          items:
            $ref: '#/components/schemas/AttributeGroupVO'

    AttributeGroupWithAttrsListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: array
          items:
            $ref: '#/components/schemas/AttributeGroupWithAttrsVO'

    # ==================== 实例相关 ====================
    CreateInstanceReq:
      type: object
      required:
        - uid
        - asset_id
        - tenant_id
      properties:
        uid:
          type: string
          description: 模型UID
          example: aliyun_ecs
        asset_id:
          type: string
          description: 云厂商资产ID
          example: i-bp1234567890abcdef
        asset_name:
          type: string
          description: 资产名称
          example: web-server-01
        tenant_id:
          type: string
          description: 租户ID
          example: tenant-001
        account_id:
          type: integer
          format: int64
          description: 云账号ID
          example: 1
        attributes:
          type: object
          description: 动态属�?
          additionalProperties: true
          example:
            status: Running
            region: cn-hangzhou
            cpu: 4
            memory: 8192
            private_ip: 192.168.1.100

    CreateBatchInstanceReq:
      type: object
      required:
        - instances
      properties:
        instances:
          type: array
          items:
            $ref: '#/components/schemas/CreateInstanceReq'

    UpsertInstanceReq:
      type: object
      required:
        - uid
        - asset_id
        - tenant_id
      properties:
        uid:
          type: string
          description: 模型UID
          example: aliyun_ecs
        asset_id:
          type: string
          description: 云厂商资产ID
          example: i-bp1234567890abcdef
        asset_name:
          type: string
          description: 资产名称
        tenant_id:
          type: string
          description: 租户ID
        account_id:
          type: integer
          format: int64
          description: 云账号ID
        attributes:
          type: object
          description: 动态属�?
          additionalProperties: true

    UpsertBatchInstanceReq:
      type: object
      required:
        - instances
      properties:
        instances:
          type: array
          items:
            $ref: '#/components/schemas/UpsertInstanceReq'

    UpdateInstanceReq:
      type: object
      properties:
        asset_name:
          type: string
          description: 资产名称
        attributes:
          type: object
          description: 动态属�?(会与现有属性合�?
          additionalProperties: true

    InstanceVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 实例ID
          example: 1001
        uid:
          type: string
          description: 模型UID
          example: aliyun_ecs
        asset_id:
          type: string
          description: 云厂商资产ID
          example: i-bp1234567890abcdef
        asset_name:
          type: string
          description: 资产名称
          example: web-server-01
        tenant_id:
          type: string
          description: 租户ID
          example: tenant-001
        account_id:
          type: integer
          format: int64
          description: 云账号ID
          example: 1
        attributes:
          type: object
          description: 动态属�?
          additionalProperties: true
          example:
            status: Running
            region: cn-hangzhou
            zone: cn-hangzhou-h
            cpu: 4
            memory: 8192
            private_ip: 192.168.1.100
            public_ip: 47.100.1.100
            instance_type: ecs.c6.xlarge
        create_time:
          type: integer
          format: int64
          description: 创建时间�?毫秒)
        update_time:
          type: integer
          format: int64
          description: 更新时间�?毫秒)

    CreateInstanceResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            id:
              type: integer
              format: int64
              description: 创建的实例ID

    BatchCreateResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            count:
              type: integer
              format: int64
              description: 创建的实例数�?

    InstanceResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/InstanceVO'

    InstanceListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            instances:
              type: array
              items:
                $ref: '#/components/schemas/InstanceVO'
            total:
              type: integer
              format: int64
              description: 总数

    # ==================== 模型关系相关 Schema ====================
    CreateModelRelationReq:
      type: object
      required:
        - uid
        - name
        - source_uid
        - target_uid
        - relation_type
      properties:
        uid:
          type: string
          description: 关系类型唯一标识
          example: ecs_belongs_to_vpc
        name:
          type: string
          description: 关系名称
          example: ECS属于VPC
        source_uid:
          type: string
          description: 源模型UID
          example: aliyun_ecs
        target_uid:
          type: string
          description: 目标模型UID
          example: aliyun_vpc
        relation_type:
          type: string
          description: 关系类型
          enum: [belongs_to, contains, bindto, connects, depends_on]
          example: belongs_to
        direction:
          type: string
          description: 方向
          enum: [one_to_one, one_to_many, many_to_many]
          example: many_to_one
        source_to_target:
          type: string
          description: 源到目标的描�?
          example: 属于
        target_to_source:
          type: string
          description: 目标到源的描�?
          example: 包含
        description:
          type: string
          description: 描述

    UpdateModelRelationReq:
      type: object
      properties:
        name:
          type: string
        source_to_target:
          type: string
        target_to_source:
          type: string
        description:
          type: string

    ModelRelationVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        uid:
          type: string
          example: ecs_belongs_to_vpc
        name:
          type: string
          example: ECS属于VPC
        source_uid:
          type: string
          example: aliyun_ecs
        target_uid:
          type: string
          example: aliyun_vpc
        relation_type:
          type: string
          example: belongs_to
        direction:
          type: string
          example: many_to_one
        source_to_target:
          type: string
          example: 属于
        target_to_source:
          type: string
          example: 包含
        description:
          type: string
        create_time:
          type: integer
          format: int64
        update_time:
          type: integer
          format: int64

    ModelRelationResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/ModelRelationVO'

    ModelRelationListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            relations:
              type: array
              items:
                $ref: '#/components/schemas/ModelRelationVO'
            total:
              type: integer
              format: int64


    # ==================== 实例关系相关 Schema ====================
    CreateInstanceRelationReq:
      type: object
      required:
        - source_instance_id
        - target_instance_id
        - relation_type_uid
        - tenant_id
      properties:
        source_instance_id:
          type: integer
          format: int64
          description: 源实例ID
          example: 1001
        target_instance_id:
          type: integer
          format: int64
          description: 目标实例ID
          example: 2001
        relation_type_uid:
          type: string
          description: 关系类型UID
          example: ecs_belongs_to_vpc
        tenant_id:
          type: string
          description: 租户ID
          example: tenant-001

    CreateBatchInstanceRelationReq:
      type: object
      required:
        - relations
      properties:
        relations:
          type: array
          items:
            $ref: '#/components/schemas/CreateInstanceRelationReq'

    InstanceRelationVO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        source_instance_id:
          type: integer
          format: int64
        target_instance_id:
          type: integer
          format: int64
        relation_type_uid:
          type: string
        tenant_id:
          type: string
        create_time:
          type: integer
          format: int64

    InstanceRelationListResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            relations:
              type: array
              items:
                $ref: '#/components/schemas/InstanceRelationVO'
            total:
              type: integer
              format: int64

    CreateIDResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            id:
              type: integer
              format: int64
              description: 创建的记录ID


    # ==================== 拓扑相关 Schema ====================
    TopologyNode:
      type: object
      description: 拓扑节点（实例）
      properties:
        id:
          type: integer
          format: int64
          description: 实例ID
          example: 1001
        uid:
          type: string
          description: 模型UID
          example: aliyun_ecs
        model_name:
          type: string
          description: 模型名称
          example: 阿里云ECS
        asset_id:
          type: string
          description: 资产ID
          example: i-bp1234567890abcdef
        asset_name:
          type: string
          description: 资产名称
          example: web-server-01
        attributes:
          type: object
          description: 动态属�?
          additionalProperties: true
        icon:
          type: string
          description: 图标
        category:
          type: string
          description: 资源类别
          example: compute

    TopologyEdge:
      type: object
      description: 拓扑边（关系�?
      properties:
        source_id:
          type: integer
          format: int64
          description: 源实例ID
          example: 1001
        target_id:
          type: integer
          format: int64
          description: 目标实例ID
          example: 2001
        relation_type_uid:
          type: string
          description: 关系类型UID
          example: ecs_belongs_to_vpc
        relation_name:
          type: string
          description: 关系名称
          example: ECS属于VPC
        relation_type:
          type: string
          description: 关系类型
          example: belongs_to

    TopologyGraph:
      type: object
      description: 实例拓扑�?
      properties:
        nodes:
          type: array
          description: 节点列表
          items:
            $ref: '#/components/schemas/TopologyNode'
        edges:
          type: array
          description: 边列�?
          items:
            $ref: '#/components/schemas/TopologyEdge'

    TopologyGraphResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/TopologyGraph'

    ModelTopologyNode:
      type: object
      description: 模型拓扑节点
      properties:
        uid:
          type: string
          description: 模型UID
          example: aliyun_ecs
        name:
          type: string
          description: 模型名称
          example: 阿里云ECS
        category:
          type: string
          description: 资源类别
          example: compute
        provider:
          type: string
          description: 云厂�?
          example: aliyun
        icon:
          type: string
          description: 图标

    ModelTopologyEdge:
      type: object
      description: 模型拓扑�?
      properties:
        source_uid:
          type: string
          description: 源模型UID
          example: aliyun_ecs
        target_uid:
          type: string
          description: 目标模型UID
          example: aliyun_vpc
        relation_uid:
          type: string
          description: 关系UID
          example: ecs_belongs_to_vpc
        relation_name:
          type: string
          description: 关系名称
          example: ECS属于VPC
        relation_type:
          type: string
          description: 关系类型
          example: belongs_to

    ModelTopologyGraph:
      type: object
      description: 模型拓扑�?
      properties:
        nodes:
          type: array
          description: 模型节点列表
          items:
            $ref: '#/components/schemas/ModelTopologyNode'
        edges:
          type: array
          description: 模型关系边列�?
          items:
            $ref: '#/components/schemas/ModelTopologyEdge'

    ModelTopologyGraphResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          $ref: '#/components/schemas/ModelTopologyGraph'

    RelatedInstancesResp:
      type: object
      properties:
        code:
          type: integer
          example: 0
        msg:
          type: string
          example: success
        data:
          type: object
          properties:
            instances:
              type: array
              items:
                $ref: '#/components/schemas/InstanceVO'
            total:
              type: integer
              description: 关联实例数量
